require=function(r,e,n){function t(n,o){function i(r){return t(i.resolve(r))}function f(e){return r[n][1][e]||e}if(!e[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(u)return u(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}i.resolve=f;var a=e[n]=new t.Module;r[n][0].call(a.exports,i,a,a.exports)}return e[n].exports}function o(){this.bundle=t,this.exports={}}var u="function"==typeof require&&require;t.Module=o,t.modules=r,t.cache=e,t.parent=u;for(var i=0;i<n.length;i++)t(n[i]);return t}({21:[function(require,module,exports) {
"use strict";var e,o;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SQUARE=1]="SQUARE",e[e.LINE=2]="LINE",e[e.L=3]="L",e[e.J=4]="J",e[e.T=5]="T",e[e.S=6]="S",e[e.Z=7]="Z"}(e=exports.TetrominoType||(exports.TetrominoType={})),exports.Shapes=((o={})[e.SQUARE]=[[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]]],o[e.LINE]=[[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]],[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[0,0,0,0],[0,0,0,0],[2,2,2,2],[0,0,0,0]],[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]]],o[e.L]=[[[0,0,3],[3,3,3],[0,0,0]],[[0,3,0],[0,3,0],[0,3,3]],[[0,0,0],[3,3,3],[3,0,0]],[[3,3,0],[0,3,0],[0,3,0]]],o[e.J]=[[[4,0,0],[4,4,4],[0,0,0]],[[0,4,4],[0,4,0],[0,4,0]],[[0,0,0],[4,4,4],[0,0,4]],[[0,4,0],[0,4,0],[4,4,0]]],o[e.S]=[[[0,5,5],[5,5,0],[0,0,0]],[[0,5,0],[0,5,5],[0,0,5]],[[0,0,0],[0,5,5],[5,5,0]],[[5,0,0],[5,5,0],[0,5,0]]],o[e.Z]=[[[6,6,0],[0,6,6],[0,0,0]],[[0,0,6],[0,6,6],[0,6,0]],[[0,0,0],[6,6,0],[0,6,6]],[[0,6,0],[6,6,0],[6,0,0]]],o[e.T]=[[[0,7,0],[7,7,7],[0,0,0]],[[0,7,0],[0,7,7],[0,7,0]],[[0,0,0],[7,7,7],[0,7,0]],[[0,7,0],[7,7,0],[0,7,0]]],o);
},{}],18:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.red=1]="red",e[e.blue=2]="blue",e[e.green=3]="green",e[e.brown=4]="brown",e[e.purple=5]="purple",e[e.aqua=6]="aqua",e[e.orange=7]="orange"}(e=exports.Colors||(exports.Colors={})),exports.Backgrounds=["#ffffff","#52aced","#388601","#30f894","#550918","#917232","#ad18dc","#6181d9","#97226e","#e0a60a","#340770"];
},{}],20:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./color");function r(e,r){e.className?e.className+=" "+r:e.className=r}function s(e,r,s,t){s.fillRect(e*t,r*t,t,t);var o=s.strokeStyle;s.strokeStyle="#222222",s.strokeRect(e*t,r*t,t,t),s.strokeStyle=o}function t(e,r){for(var s=0;s<3;s++)for(var t=0;t<4;t++)e.fillStyle="white",e.fillRect(t*r.size,s*r.size,r.size,r.size)}function o(r,t){for(var o=e.Colors[t.type],a=0;a<3;a++)for(var l=0;l<4;l++)t.shape[a]&&t.shape[a][l]&&t.shape[a][l]>0&&(r.fillStyle=o,s(l,a,r,t.size))}exports.addClass=r,exports.drawSquare=s,exports.clearNextPiece=t,exports.drawNextPiece=o;
},{"./color":18}],16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./shape"),i=require("../util/color"),o=require("../util"),e=function(){function e(o,e,h){this.type=o,this.boardWidth=e,this.size=h,this.rotation=0,this.color=i.Colors[this.type],this.shape=t.Shapes[this.type][this.rotation],this.row=-1,this.col=this.boardWidth/2-Math.ceil(this.shape.length/2)}return e.prototype.draw=function(t){this.fill(t,i.Colors[this.type])},e.prototype.left=function(t){this.clear(t),this.col--,this.draw(t)},e.prototype.right=function(t){this.clear(t),this.col++,this.draw(t)},e.prototype.down=function(t){this.clear(t),this.row++,this.draw(t)},e.prototype.hardDown=function(t,i){this.clear(t),this.row+=i-1,this.draw(t)},e.prototype.rotate=function(i,o){this.clear(i),this.col+=o,this.rotation=(this.rotation+1)%4,this.shape=t.Shapes[this.type][this.rotation],this.draw(i)},e.prototype.set=function(t){for(var i=0;i<this.shape.length;i++)for(var o=0;o<this.shape.length;o++)this.shape[i][o]&&t(this.row+i,this.col+o,this.type)},e.prototype.isAtTop=function(){for(var t=0;t<this.shape.length;t++)for(var i=0;i<this.shape.length;i++)if(this.shape[t][i]&&this.row+t<=0)return!0;return!1},e.getRandomType=function(){return Math.floor(7*Math.random())+1},e.randomPiece=function(t,i){return new e(e.getRandomType(),t,i)},e.prototype.fill=function(t,i){for(var e=0;e<this.shape.length;e++)for(var h=0;h<this.shape.length;h++){this.shape[e][h]>0&&(t.fillStyle=i,o.drawSquare(this.col+h,this.row+e,t,this.size))}},e.prototype.clear=function(t){this.fill(t,"white")},e}();exports.Piece=e;
},{"./shape":21,"../util/color":18,"../util":20}],19:[function(require,module,exports) {
"use strict";var E;Object.defineProperty(exports,"__esModule",{value:!0}),function(E){E[E.PAUSE=0]="PAUSE",E[E.UNPAUSE=1]="UNPAUSE",E[E.START=2]="START",E[E.RESTART=3]="RESTART",E[E.GAME_OVER=4]="GAME_OVER",E[E.MOVE_LEFT=5]="MOVE_LEFT",E[E.MOVE_RIGHT=6]="MOVE_RIGHT",E[E.MOVE_DOWN=7]="MOVE_DOWN",E[E.HARD_DOWN=8]="HARD_DOWN",E[E.ROTATE=9]="ROTATE",E[E.AUDIO_STOP=10]="AUDIO_STOP",E[E.AUDIO_START=11]="AUDIO_START"}(E=exports.GameEvent||(exports.GameEvent={}));
},{}],15:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./shape"),i=require("../util"),e=require("../util/color"),h=require("./piece"),r=require("./event"),s=function(){function s(t,i,e,h){this.width=i,this.height=e,this.container=t,this.ctx=this.container.getContext("2d"),this.tileSize=h,this.container.width=this.width*this.tileSize,this.container.height=this.height*this.tileSize,this.grid=this.initGrid()}return s.prototype.draw=function(){for(var t=0;t<this.height;t++)for(var h=this.grid[t],r=0;r<this.width;r++){var s=h[r];this.ctx.fillStyle=s>0?e.Colors[s]:"white",i.drawSquare(r,t,this.ctx,this.tileSize)}this.activePiece.draw(this.ctx)},s.prototype.clearLines=function(){for(var t=0,i=0;i<this.height;i++){if(0===this.grid[i].filter(function(t){return 0===t}).length){t++;for(var e=i;e>0;e--)for(var h=0;h<this.width;h++)this.grid[e][h]=this.grid[e-1][h];for(h=0;h<this.width;h++)this.grid[0][h]=0}}return t},s.prototype.handleEvent=function(i){switch(i){case r.GameEvent.MOVE_LEFT:this.collides(-1,0,this.activePiece.shape)||this.activePiece.left(this.ctx);break;case r.GameEvent.MOVE_RIGHT:this.collides(1,0,this.activePiece.shape)||this.activePiece.right(this.ctx);break;case r.GameEvent.MOVE_DOWN:if(this.collides(0,1,this.activePiece.shape))return!0;this.activePiece.down(this.ctx);break;case r.GameEvent.HARD_DOWN:for(var e=1;!this.collides(0,e,this.activePiece.shape);)e++;return this.activePiece.hardDown(this.ctx,e),!0;case r.GameEvent.ROTATE:var h=(this.activePiece.rotation+1)%4,s=t.Shapes[this.activePiece.type][h],c=0;if(this.collides(0,0,s)&&(c=this.activePiece.col>this.width/2?-1:1),this.collides(c,0,s))break;this.activePiece.rotate(this.ctx,c);break;default:return!1}return!1},s.prototype.reset=function(){this.grid=this.initGrid(),this.activePiece=h.Piece.randomPiece(this.width,this.tileSize)},s.prototype.initGrid=function(){for(var t=[],i=0;i<this.height;i++){for(var e=[],h=0;h<this.width;h++)e.push(0);t.push(e)}return t},s.prototype.movePieceDown=function(){return!!this.collides(0,1,this.activePiece.shape)||(this.activePiece.down(this.ctx),!1)},s.prototype.lockPiece=function(){this.activePiece.set(this.setOnBoard.bind(this))},s.prototype.setOnBoard=function(t,i,e){this.grid[t][i]=e},s.prototype.collides=function(t,i,e){for(var h=0;h<e.length;h++)for(var r=0;r<e.length;r++){if(0!==e[h][r]){var s=this.activePiece.col+r+t,c=this.activePiece.row+h+i;if(c>=this.height||s<0||s>=this.width)return!0;if(!(c<0)&&this.grid[c][s])return!0}}return!1},s}();exports.Board=s;
},{"./shape":21,"../util":20,"../util/color":18,"./piece":16,"./event":19}],17:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SPACE=32]="SPACE",e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.LEFT=37]="LEFT",e[e.RIGHT=39]="RIGHT",e[e.A=65]="A",e[e.D=68]="D",e[e.Q=81]="Q",e[e.S=83]="S",e[e.W=87]="W"}(e=exports.Keys||(exports.Keys={}));
},{}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./model/board"),t=require("./model/piece"),i=require("./util/keys"),s=require("./util/color"),n=require("./model/event"),o=require("./util"),a=function(){function a(i){this.container=i,this.width=10,this.height=20,this.tileSize=32,this.board=new e.Board(this.container,this.width,this.height,this.tileSize),this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.nextPieceContainer=document.getElementById("nextpiece"),this.nextPieceContainer.width=4*this.tileSize,this.nextPieceContainer.height=3*this.tileSize,this.music=document.getElementById("music"),this.running=!0,this.paused=!1,this.shouldStep=!1,this.audioPlaying=!0,this.level=0,this.lines=0,this.score=0,this.queuedActions=[],this.dt=0,this.step=1.1,this.needNewPiece=!1}return a.prototype.start=function(){this.createListeners(),this.board.activePiece=this.nextPiece,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.drawNextPiece(this.nextPiece),this.music.play(),this.music.loop=!0,this.music.volume=.3,this.lastTick=performance.now(),requestAnimationFrame(this.loop.bind(this))},a.prototype.createListeners=function(){var e=this;document.body.addEventListener("keydown",this.getInput.bind(this),!1);var t=document.getElementById("btn-audio-muted"),i=document.getElementById("btn-audio-playing"),s=document.getElementById("btn-pause"),o=document.getElementById("btn-restart"),a=document.getElementById("btn-playagain");t.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.AUDIO_START)}),i.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.AUDIO_STOP)}),s.addEventListener("click",function(t){e.running&&(e.paused?e.queuedActions.push(n.GameEvent.PAUSE):e.queuedActions.push(n.GameEvent.UNPAUSE))},!1),o.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.RESTART)},!1),a.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.RESTART)})},a.prototype.getInput=function(e){switch(e.keyCode){case i.Keys.A,i.Keys.LEFT:this.queuedActions.push(n.GameEvent.MOVE_LEFT);break;case i.Keys.D,i.Keys.RIGHT:this.queuedActions.push(n.GameEvent.MOVE_RIGHT);break;case i.Keys.W,i.Keys.UP:this.queuedActions.push(n.GameEvent.ROTATE);break;case i.Keys.D,i.Keys.DOWN:this.queuedActions.push(n.GameEvent.MOVE_DOWN);break;case i.Keys.SPACE:this.queuedActions.push(n.GameEvent.HARD_DOWN);break;case i.Keys.Q:if(!this.running)return;this.paused?this.queuedActions.push(n.GameEvent.UNPAUSE):this.queuedActions.push(n.GameEvent.PAUSE)}},a.prototype.loop=function(e){var t=performance.now();this.update((t-this.lastTick)/1e3),this.draw(),this.lastTick=t,requestAnimationFrame(this.loop.bind(this))},a.prototype.draw=function(){this.board.draw(),this.drawNextPiece(this.nextPiece)},a.prototype.update=function(e){if(this.handleNextEvent(),!this.paused){if(this.shouldStep&&(this.needNewPiece=this.board.movePieceDown(),this.shouldStep=!1),this.dt+=e,this.dt>this.step&&(this.dt-=this.step,this.needNewPiece=this.board.movePieceDown(),this.shouldStep=!1),this.needNewPiece){if(this.board.activePiece.isAtTop())return this.queuedActions=Array.of(n.GameEvent.GAME_OVER),void(this.needNewPiece=!1);this.needNewPiece=!1,this.board.lockPiece(),this.board.activePiece=this.nextPiece,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize)}var i=this.board.clearLines();this.updateStats(i)}},a.prototype.handleNextEvent=function(){var e=this.queuedActions.shift();if(void 0!==e)switch(e){case n.GameEvent.HARD_DOWN:case n.GameEvent.MOVE_DOWN:case n.GameEvent.MOVE_LEFT:case n.GameEvent.MOVE_RIGHT:case n.GameEvent.ROTATE:if(this.board.handleEvent(e))return void(this.shouldStep=!0);break;case n.GameEvent.PAUSE:this.pauseGame();break;case n.GameEvent.UNPAUSE:this.unpauseGame();break;case n.GameEvent.AUDIO_START:this.audioPlaying=!0,this.switchAudioButton();break;case n.GameEvent.AUDIO_STOP:this.audioPlaying=!1,this.switchAudioButton();break;case n.GameEvent.RESTART:this.reset();break;case n.GameEvent.GAME_OVER:this.gameOver()}},a.prototype.drawNextPiece=function(e){var t=this.nextPieceContainer.getContext("2d");o.clearNextPiece(t,this.nextPiece),o.drawNextPiece(t,this.nextPiece)},a.prototype.updateBackground=function(){document.body.style.backgroundColor=s.Backgrounds[this.level]},a.prototype.updateStats=function(e){var t=document.getElementById("level"),i=document.getElementById("lines"),s=document.getElementById("score");this.lines+=e,i.textContent=""+this.lines,this.score+=this.getScoreForLines(e),s.textContent=""+this.score,this.shouldIncreaseLevel()&&(this.level++,this.step=this.step-.1,this.updateBackground()),t.textContent=""+this.level},a.prototype.pauseGame=function(){this.paused=!0;var e=document.getElementById("pause-overlay");e&&(e.style.display="block")},a.prototype.unpauseGame=function(){this.paused=!1;var e=document.getElementById("pause-overlay");e&&(e.style.display="none"),requestAnimationFrame(this.loop.bind(this))},a.prototype.gameOver=function(){this.running=!1,this.paused=!0;var e=document.getElementById("overlay");e&&(e.style.display="block")},a.prototype.reset=function(){var e=document.getElementById("overlay");e&&(e.style.display="none"),this.unpauseGame(),this.running=!0,this.shouldStep=!1,this.needNewPiece=!1,this.queuedActions=[],this.lines=0,this.score=0,this.level=0,this.step=1.1,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.board.reset(),this.updateBackground(),this.lastTick=performance.now(),requestAnimationFrame(this.loop.bind(this))},a.prototype.switchAudioButton=function(){var e=document.getElementById("btn-audio-muted"),t=document.getElementById("btn-audio-playing");this.audioPlaying?(this.music.play(),t.style.display="inline-block",e.style.display="none"):(this.music.pause(),t.style.display="none",e.style.display="inline-block")},a.prototype.getScoreForLines=function(e){return[0,40,100,300,1200][e]*(this.level+1)},a.prototype.shouldIncreaseLevel=function(){return 10!==this.level&&this.lines>=10*(this.level+1)},a}(),h=document.getElementById("game"),u=new a(h);u.start();
},{"./model/board":15,"./model/piece":16,"./util/keys":17,"./util/color":18,"./model/event":19,"./util":20}]},{},[12])
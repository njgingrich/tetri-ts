require=function(r,e,n){function t(n,o){function i(r){return t(i.resolve(r))}function f(e){return r[n][1][e]||e}if(!e[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(u)return u(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}i.resolve=f;var a=e[n]=new t.Module;r[n][0].call(a.exports,i,a,a.exports)}return e[n].exports}function o(){this.bundle=t,this.exports={}}var u="function"==typeof require&&require;t.Module=o,t.modules=r,t.cache=e,t.parent=u;for(var i=0;i<n.length;i++)t(n[i]);return t}({17:[function(require,module,exports) {
"use strict";var e,o;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SQUARE=1]="SQUARE",e[e.LINE=2]="LINE",e[e.L=3]="L",e[e.J=4]="J",e[e.T=5]="T",e[e.S=6]="S",e[e.Z=7]="Z"}(e=exports.TetrominoType||(exports.TetrominoType={})),exports.Shapes=((o={})[e.SQUARE]=[[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]]],o[e.LINE]=[[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]],[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[0,0,0,0],[0,0,0,0],[2,2,2,2],[0,0,0,0]],[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]]],o[e.L]=[[[0,0,3],[3,3,3],[0,0,0]],[[0,3,0],[0,3,0],[0,3,3]],[[0,0,0],[3,3,3],[3,0,0]],[[3,3,0],[0,3,0],[0,3,0]]],o[e.J]=[[[4,0,0],[4,4,4],[0,0,0]],[[0,4,4],[0,4,0],[0,4,0]],[[0,0,0],[4,4,4],[0,0,4]],[[0,4,0],[0,4,0],[4,4,0]]],o[e.S]=[[[0,5,5],[5,5,0],[0,0,0]],[[0,5,0],[0,5,5],[0,0,5]],[[0,0,0],[0,5,5],[5,5,0]],[[5,0,0],[5,5,0],[0,5,0]]],o[e.Z]=[[[6,6,0],[0,6,6],[0,0,0]],[[0,0,6],[0,6,6],[0,6,0]],[[0,0,0],[6,6,0],[0,6,6]],[[0,6,0],[6,6,0],[6,0,0]]],o[e.T]=[[[0,7,0],[7,7,7],[0,0,0]],[[0,7,0],[0,7,7],[0,7,0]],[[0,0,0],[7,7,7],[0,7,0]],[[0,7,0],[7,7,0],[0,7,0]]],o);
},{}],18:[function(require,module,exports) {
"use strict";function e(e,s){e.className?e.className+=" "+s:e.className=s}function s(e,s,t,r){t.fillRect(e*r,s*r,r,r);var a=t.strokeStyle;t.strokeStyle="#222222",t.strokeRect(e*r,s*r,r,r),t.strokeStyle=a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addClass=e,exports.drawSquare=s;
},{}],11:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.red=1]="red",e[e.blue=2]="blue",e[e.green=3]="green",e[e.brown=4]="brown",e[e.purple=5]="purple",e[e.aqua=6]="aqua",e[e.orange=7]="orange"}(e=exports.Colors||(exports.Colors={})),exports.Backgrounds=["#ffffff","#52aced","#388601","#30f894","#550918","#917232","#ad18dc","#6181d9","#97226e","#e0a60a","#340770"];
},{}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./shape"),i=require("../util/color"),e=require("../util"),o=function(){function o(e,o,h){this.type=e,this.boardWidth=o,this.size=h,this.rotation=0,this.color=i.Colors[this.type],this.shape=t.Shapes[this.type][this.rotation],this.row=-1,this.col=this.boardWidth/2-Math.ceil(this.shape.length/2)}return o.prototype.draw=function(t){this.fill(t,i.Colors[this.type])},o.prototype.clearNextPiece=function(t){this.fillNextPiece(t,"white")},o.prototype.drawNextPiece=function(t){this.fillNextPiece(t,i.Colors[this.type])},o.prototype.left=function(t){this.clear(t),this.col--,this.draw(t)},o.prototype.right=function(t){this.clear(t),this.col++,this.draw(t)},o.prototype.down=function(t){this.clear(t),this.row++,this.draw(t)},o.prototype.hardDown=function(t,i){this.clear(t),this.row+=i-1,this.draw(t)},o.prototype.rotate=function(i,e){this.clear(i),this.col+=e,this.rotation=(this.rotation+1)%4,this.shape=t.Shapes[this.type][this.rotation],this.draw(i)},o.prototype.set=function(t){for(var i=0;i<this.shape.length;i++)for(var e=0;e<this.shape.length;e++)this.shape[i][e]&&t(this.row+i,this.col+e,this.type)},o.prototype.isAtTop=function(){for(var t=0;t<this.shape.length;t++)for(var i=0;i<this.shape.length;i++)if(this.shape[t][i]&&this.row+t<=0)return!0;return!1},o.getRandomType=function(){return Math.floor(7*Math.random())+1},o.randomPiece=function(t,i){return new o(o.getRandomType(),t,i)},o.prototype.fill=function(t,i){for(var o=0;o<this.shape.length;o++)for(var h=0;h<this.shape.length;h++){this.shape[o][h]>0&&(t.fillStyle=i,e.drawSquare(this.col+h,this.row+o,t,this.size))}},o.prototype.clear=function(t){this.fill(t,"white")},o.prototype.fillNextPiece=function(t,i){for(var o=0;o<4;o++)for(var h=0;h<4;h++)this.shape[o]&&this.shape[o][h]?this.shape[o][h]>0&&(t.fillStyle=i,e.drawSquare(h,o,t,this.size)):(t.fillStyle="white",e.drawSquare(h,o,t,this.size))},o}();exports.Piece=o;
},{"./shape":17,"../util/color":11,"../util":18}],12:[function(require,module,exports) {
"use strict";var E;Object.defineProperty(exports,"__esModule",{value:!0}),function(E){E[E.PAUSE=0]="PAUSE",E[E.UNPAUSE=1]="UNPAUSE",E[E.START=2]="START",E[E.RESTART=3]="RESTART",E[E.GAME_OVER=4]="GAME_OVER",E[E.MOVE_LEFT=5]="MOVE_LEFT",E[E.MOVE_RIGHT=6]="MOVE_RIGHT",E[E.MOVE_DOWN=7]="MOVE_DOWN",E[E.HARD_DOWN=8]="HARD_DOWN",E[E.ROTATE=9]="ROTATE"}(E=exports.GameEvent||(exports.GameEvent={}));
},{}],8:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("./shape"),t=require("../util"),e=require("../util/color"),h=require("./piece"),s=require("./event"),r=function(){function r(i,t,e,h){this.width=t,this.height=e,this.container=i,this.ctx=this.container.getContext("2d"),this.tileSize=h,this.container.width=this.width*this.tileSize,this.container.height=this.height*this.tileSize,this.grid=this.initGrid()}return r.prototype.draw=function(){for(var i=0;i<this.height;i++)for(var h=this.grid[i],s=0;s<this.width;s++){var r=h[s];this.ctx.fillStyle=r>0?e.Colors[r]:"white",t.drawSquare(s,i,this.ctx,this.tileSize)}this.activePiece.draw(this.ctx)},r.prototype.clearLines=function(){for(var i=0,t=0;t<this.height;t++){if(0===this.grid[t].filter(function(i){return 0===i}).length){i++;for(var e=t;e>0;e--)for(var h=0;h<this.width;h++)this.grid[e][h]=this.grid[e-1][h];for(h=0;h<this.width;h++)this.grid[0][h]=0}}return i},r.prototype.handleEvent=function(t){switch(t){case s.GameEvent.MOVE_LEFT:this.collides(this.activePiece,-1,0,this.activePiece.shape)||this.activePiece.left(this.ctx);break;case s.GameEvent.MOVE_RIGHT:this.collides(this.activePiece,1,0,this.activePiece.shape)||this.activePiece.right(this.ctx);break;case s.GameEvent.MOVE_DOWN:if(this.collides(this.activePiece,0,1,this.activePiece.shape))return!0;this.activePiece.down(this.ctx);break;case s.GameEvent.HARD_DOWN:for(var e=1;!this.collides(this.activePiece,0,e,this.activePiece.shape);)e++;this.activePiece.hardDown(this.ctx,e);break;case s.GameEvent.ROTATE:var h=(this.activePiece.rotation+1)%4,r=i.Shapes[this.activePiece.type][h],c=0;if(this.collides(this.activePiece,0,0,r)&&(c=this.activePiece.col>this.width/2?-1:1),this.collides(this.activePiece,c,0,r))break;this.activePiece.rotate(this.ctx,c);break;default:return!1}return!1},r.prototype.reset=function(){this.grid=this.initGrid(),this.activePiece=h.Piece.randomPiece(this.width,this.tileSize)},r.prototype.initGrid=function(){for(var i=[],t=0;t<this.height;t++){for(var e=[],h=0;h<this.width;h++)e.push(0);i.push(e)}return i},r.prototype.movePieceDown=function(){return!!this.collides(this.activePiece,0,1,this.activePiece.shape)||(this.activePiece.down(this.ctx),!1)},r.prototype.lockPiece=function(){this.activePiece.set(this.setOnBoard.bind(this))},r.prototype.setOnBoard=function(i,t,e){this.grid[i][t]=e},r.prototype.collides=function(i,t,e,h){for(var s=0;s<h.length;s++)for(var r=0;r<h.length;r++){if(0!==h[s][r]){var c=i.col+r+t,a=i.row+s+e;if(a>=this.height||c<0||c>=this.width)return!0;if(!(a<0)&&this.grid[a][c])return!0}}return!1},r}();exports.Board=r;
},{"./shape":17,"../util":18,"../util/color":11,"./piece":9,"./event":12}],10:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SPACE=32]="SPACE",e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.LEFT=37]="LEFT",e[e.RIGHT=39]="RIGHT",e[e.A=65]="A",e[e.D=68]="D",e[e.Q=81]="Q",e[e.S=83]="S",e[e.W=87]="W"}(e=exports.Keys||(exports.Keys={}));
},{}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./model/board"),t=require("./model/piece"),i=require("./util/keys"),s=require("./util/color"),n=require("./model/event"),o=function(){function o(i){this.container=i,this.width=10,this.height=20,this.tileSize=32,this.board=new e.Board(this.container,this.width,this.height,this.tileSize),this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.nextPieceContainer=document.getElementById("nextpiece"),this.nextPieceContainer.width=4*this.tileSize,this.nextPieceContainer.height=4*this.tileSize,this.paused=!1,this.level=0,this.lines=0,this.score=0,this.queuedActions=[],this.dt=0,this.step=1.1,this.needNewPiece=!1}return o.prototype.start=function(){this.getInput(),this.board.activePiece=this.nextPiece,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.drawNextPiece(this.nextPiece),this.lastTick=performance.now(),requestAnimationFrame(this.loop.bind(this))},o.prototype.getInput=function(){var e=this;document.body.addEventListener("keydown",function(t){switch(t.keyCode){case i.Keys.A,i.Keys.LEFT:e.queuedActions.push(n.GameEvent.MOVE_LEFT);break;case i.Keys.D,i.Keys.RIGHT:e.queuedActions.push(n.GameEvent.MOVE_RIGHT);break;case i.Keys.W,i.Keys.UP:e.queuedActions.push(n.GameEvent.ROTATE);break;case i.Keys.D,i.Keys.DOWN:e.queuedActions.push(n.GameEvent.MOVE_DOWN);break;case i.Keys.SPACE:e.queuedActions.push(n.GameEvent.HARD_DOWN);break;case i.Keys.Q:e.paused?e.queuedActions.push(n.GameEvent.UNPAUSE):e.queuedActions.push(n.GameEvent.PAUSE)}},!1);var t=document.getElementById("btn-pause"),s=document.getElementById("btn-restart"),o=document.getElementById("btn-playagain");t.addEventListener("click",function(t){e.paused?e.queuedActions.push(n.GameEvent.PAUSE):e.queuedActions.push(n.GameEvent.UNPAUSE)},!1),s.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.RESTART)},!1),o.addEventListener("click",function(t){e.queuedActions.push(n.GameEvent.RESTART)})},o.prototype.loop=function(e){var t=performance.now();this.update((t-this.lastTick)/1e3),this.draw(),this.lastTick=t,requestAnimationFrame(this.loop.bind(this))},o.prototype.draw=function(){this.board.draw(),this.drawNextPiece(this.nextPiece)},o.prototype.update=function(e){if(this.handleNextEvent(),!this.paused){if(this.dt+=e,this.dt>this.step&&(this.dt-=this.step,this.needNewPiece=this.board.movePieceDown()),this.needNewPiece){if(this.board.activePiece.isAtTop())return this.queuedActions=Array.of(n.GameEvent.GAME_OVER),void(this.needNewPiece=!1);this.needNewPiece=!1,this.board.lockPiece(),this.board.activePiece=this.nextPiece,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize)}var i=this.board.clearLines();this.updateStats(i)}},o.prototype.handleNextEvent=function(){var e=this.queuedActions.shift();if(void 0!==e)switch(e){case n.GameEvent.HARD_DOWN:case n.GameEvent.MOVE_DOWN:case n.GameEvent.MOVE_LEFT:case n.GameEvent.MOVE_RIGHT:case n.GameEvent.ROTATE:this.board.handleEvent(e);break;case n.GameEvent.PAUSE:this.pauseGame();break;case n.GameEvent.UNPAUSE:this.unpauseGame();break;case n.GameEvent.RESTART:this.reset();break;case n.GameEvent.GAME_OVER:this.gameOver()}},o.prototype.drawNextPiece=function(e){var t=this.nextPieceContainer.getContext("2d");this.nextPiece.clearNextPiece(t),this.nextPiece.drawNextPiece(t)},o.prototype.updateBackground=function(){document.body.style.backgroundColor=s.Backgrounds[this.level]},o.prototype.updateStats=function(e){var t=document.getElementById("level"),i=document.getElementById("lines"),s=document.getElementById("score");this.lines+=e,i.textContent=""+this.lines,this.score+=this.getScoreForLines(e),s.textContent=""+this.score,this.shouldIncreaseLevel()&&(this.level++,this.step=this.step-.1,this.updateBackground()),t.textContent=""+this.level},o.prototype.pauseGame=function(){this.paused=!0;var e=document.getElementById("pause-overlay");e&&(e.style.display="block")},o.prototype.unpauseGame=function(){this.paused=!1;var e=document.getElementById("pause-overlay");e&&(e.style.display="none"),requestAnimationFrame(this.loop.bind(this))},o.prototype.gameOver=function(){var e=document.getElementById("overlay");e&&(e.style.display="block")},o.prototype.reset=function(){var e=document.getElementById("overlay");e&&(e.style.display="none"),this.lines=0,this.score=0,this.level=0,this.nextPiece=t.Piece.randomPiece(this.width,this.tileSize),this.board.reset(),this.updateBackground(),requestAnimationFrame(this.loop.bind(this))},o.prototype.getScoreForLines=function(e){return[0,40,100,300,1200][e]*(this.level+1)},o.prototype.shouldIncreaseLevel=function(){return 10!==this.level&&this.lines>=10*(this.level+1)},o}(),a=document.getElementById("game"),c=new o(a);c.start();
},{"./model/board":8,"./model/piece":9,"./util/keys":10,"./util/color":11,"./model/event":12}]},{},[6])
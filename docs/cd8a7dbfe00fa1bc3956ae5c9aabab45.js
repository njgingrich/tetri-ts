require=function(r,e,n){function t(n,o){function i(r){return t(i.resolve(r))}function f(e){return r[n][1][e]||e}if(!e[n]){if(!r[n]){var c="function"==typeof require&&require;if(!o&&c)return c(n,!0);if(u)return u(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}i.resolve=f;var a=e[n]=new t.Module;r[n][0].call(a.exports,i,a,a.exports)}return e[n].exports}function o(){this.bundle=t,this.exports={}}var u="function"==typeof require&&require;t.Module=o,t.modules=r,t.cache=e,t.parent=u;for(var i=0;i<n.length;i++)t(n[i]);return t}({9:[function(require,module,exports) {
"use strict";function e(e,s){e.className?e.className+=" "+s:e.className=s}function s(e,s,t,r){t.fillRect(e*r,s*r,r,r);var a=t.strokeStyle;t.strokeStyle="#222222",t.strokeRect(e*r,s*r,r,r),t.strokeStyle=a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addClass=e,exports.drawSquare=s;
},{}],7:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.red=1]="red",e[e.blue=2]="blue",e[e.green=3]="green",e[e.brown=4]="brown",e[e.purple=5]="purple",e[e.aqua=6]="aqua",e[e.orange=7]="orange"}(e=exports.Colors||(exports.Colors={}));
},{}],8:[function(require,module,exports) {
"use strict";var e,o;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SQUARE=1]="SQUARE",e[e.LINE=2]="LINE",e[e.L=3]="L",e[e.J=4]="J",e[e.T=5]="T",e[e.S=6]="S",e[e.Z=7]="Z"}(e=exports.TetrominoType||(exports.TetrominoType={})),exports.Shapes=((o={})[e.SQUARE]=[[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]],[[0,1,1],[0,1,1],[0,0,0]]],o[e.LINE]=[[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]],[[0,0,2,0],[0,0,2,0],[0,0,2,0],[0,0,2,0]],[[0,0,0,0],[0,0,0,0],[2,2,2,2],[0,0,0,0]],[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]]],o[e.L]=[[[0,0,3],[3,3,3],[0,0,0]],[[0,3,0],[0,3,0],[0,3,3]],[[0,0,0],[3,3,3],[3,0,0]],[[3,3,0],[0,3,0],[0,3,0]]],o[e.J]=[[[4,0,0],[4,4,4],[0,0,0]],[[0,4,4],[0,4,0],[0,4,0]],[[0,0,0],[4,4,4],[0,0,4]],[[0,4,0],[0,4,0],[4,4,0]]],o[e.S]=[[[0,5,5],[5,5,0],[0,0,0]],[[0,5,0],[0,5,5],[0,0,5]],[[0,0,0],[0,5,5],[5,5,0]],[[5,0,0],[5,5,0],[0,5,0]]],o[e.Z]=[[[6,6,0],[0,6,6],[0,0,0]],[[0,0,6],[0,6,6],[0,6,0]],[[0,0,0],[6,6,0],[0,6,6]],[[0,6,0],[6,6,0],[6,0,0]]],o[e.T]=[[[0,7,0],[7,7,7],[0,0,0]],[[0,7,0],[0,7,7],[0,7,0]],[[0,0,0],[7,7,7],[0,7,0]],[[0,7,0],[7,7,0],[0,7,0]]],o);
},{}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./shape"),i=require("../util/color"),h=require("../util"),s=function(){function s(h,s,e){this.type=h,this.boardWidth=s,this.size=e,this.rotation=0,this.color=i.Colors[this.type],this.shape=t.Shapes[this.type][this.rotation],this.row=-2,this.col=this.boardWidth/2-Math.ceil(this.shape.length/2)}return s.prototype.draw=function(t){this.fill(t,i.Colors[this.type])},s.prototype.clear=function(t){this.fill(t,"white")},s.prototype.left=function(t,i){i(this,-1,0,this.shape)||(this.clear(t),this.col--,this.draw(t))},s.prototype.right=function(t,i){i(this,1,0,this.shape)||(this.clear(t),this.col++,this.draw(t))},s.prototype.down=function(t,i,h){return i(this,0,1,this.shape)?!!this.set(h)||s.randomPiece(this.boardWidth,this.size):(this.clear(t),this.row++,this.draw(t),!1)},s.prototype.hardDown=function(t,i){for(var h=1;!i(this,0,h,this.shape);)h++;this.clear(t),this.row+=h-1,this.draw(t)},s.prototype.rotate=function(i,h){var s=t.Shapes[this.type][(this.rotation+1)%4],e=0;h(this,0,0,s)&&(e=this.col>this.boardWidth/2?-1:1),h(this,e,0,s)||(this.clear(i),this.col+=e,this.rotation=(this.rotation+1)%4,this.shape=t.Shapes[this.type][this.rotation],this.draw(i))},s.prototype.set=function(t){for(var i=0;i<this.shape.length;i++)for(var h=0;h<this.shape.length;h++)if(this.shape[i][h]){if(this.row+i<0)return!0;t(this.row+i,this.col+h,this.type)}return!1},s.getRandomType=function(){return Math.floor(7*Math.random())+1},s.randomPiece=function(t,i){return new s(s.getRandomType(),t,i)},s.prototype.fill=function(t,i){for(var s=0;s<this.shape.length;s++)for(var e=0;e<this.shape.length;e++){this.shape[s][e]>0&&(t.fillStyle=i,h.drawSquare(this.col+e,this.row+s,t,this.size))}},s}();exports.Piece=s;
},{"./shape":8,"../util/color":7,"../util":9}],6:[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),function(e){e[e.SPACE=32]="SPACE",e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.LEFT=37]="LEFT",e[e.RIGHT=39]="RIGHT",e[e.A=65]="A",e[e.D=68]="D",e[e.Q=81]="Q",e[e.S=83]="S",e[e.W=87]="W"}(e=exports.Keys||(exports.Keys={}));
},{}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=require("../util"),t=require("../util/color"),e=require("./piece"),h=require("../util/keys"),s=function(){function s(i,t,e,h){this.width=t,this.height=e,this.container=i,this.ctx=this.container.getContext("2d"),this.tileSize=h,this.container.width=this.width*this.tileSize,this.container.height=this.height*this.tileSize,this.grid=this.initGrid()}return s.prototype.draw=function(){for(var e=0;e<this.height;e++)for(var h=this.grid[e],s=0;s<this.width;s++){var r=h[s];this.ctx.fillStyle=r>0?t.Colors[r]:"white",i.drawSquare(s,e,this.ctx,this.tileSize)}this.activePiece.draw(this.ctx)},s.prototype.clearLines=function(){for(var i=0,t=0;t<this.height;t++){if(0===this.grid[t].filter(function(i){return 0===i}).length){i++;for(var e=t;e>0;e--)for(var h=0;h<this.width;h++)this.grid[e][h]=this.grid[e-1][h];for(h=0;h<this.width;h++)this.grid[0][h]=0}}return i},s.prototype.getInput=function(i){i.keyCode!==h.Keys.UP&&i.keyCode!==h.Keys.W||this.activePiece.rotate(this.ctx,this.collides.bind(this)),i.keyCode!==h.Keys.DOWN&&i.keyCode!==h.Keys.S||this.activePiece.down(this.ctx,this.collides.bind(this),this.setOnBoard.bind(this)),i.keyCode!==h.Keys.LEFT&&i.keyCode!==h.Keys.A||this.activePiece.left(this.ctx,this.collides.bind(this)),i.keyCode!==h.Keys.RIGHT&&i.keyCode!==h.Keys.D||this.activePiece.right(this.ctx,this.collides.bind(this)),i.keyCode===h.Keys.SPACE&&this.activePiece.hardDown(this.ctx,this.collides.bind(this))},s.prototype.reset=function(){this.grid=this.initGrid(),this.activePiece=e.Piece.randomPiece(this.width,this.tileSize)},s.prototype.initGrid=function(){for(var i=[],t=0;t<this.height;t++){for(var e=[],h=0;h<this.width;h++)e.push(0);i.push(e)}return i},s.prototype.movePieceDown=function(){return this.activePiece.down(this.ctx,this.collides.bind(this),this.setOnBoard.bind(this))},s.prototype.setOnBoard=function(i,t,e){this.grid[i][t]=e},s.prototype.collides=function(i,t,e,h){for(var s=0;s<h.length;s++)for(var r=0;r<h.length;r++){if(0!==h[s][r]){var o=i.col+r+t,n=i.row+s+e;if(n>=this.height||o<0||o>=this.width)return!0;if(!(n<0)&&this.grid[n][o])return!0}}return!1},s}();exports.Board=s;
},{"../util":9,"../util/color":7,"./piece":5,"../util/keys":6}],3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./model/board"),t=require("./model/piece"),i=require("./util/keys"),s=function(){function s(t){this.container=t,this.width=10,this.height=20,this.tileSize=32,this.board=new e.Board(this.container,this.width,this.height,this.tileSize),this.onDeck=null,this.levelEl=document.getElementById("level"),this.linesEl=document.getElementById("lines"),this.scoreEl=document.getElementById("score"),this.paused=!1,this.gameOver=!1,this.level=0,this.lines=0,this.score=0,this.raf=-1,this.limit=300,this.lastFrameTimeMs=0,this.maxFPS=60,this.delta=0,this.timestep=1e3/60,this.fps=60,this.framesThisSecond=0,this.lastFpsUpdate=0,this.gravity=40}return s.prototype.start=function(){this.getInput(),this.board.activePiece=t.Piece.randomPiece(this.width,this.tileSize),this.raf=requestAnimationFrame(this.gameLoop.bind(this))},s.prototype.getInput=function(){var e=this;function t(){this.paused=!this.paused,this.paused?this.pauseGame():this.unpauseGame()}document.body.addEventListener("keydown",function(s){e.board.getInput(s),s.keyCode===i.Keys.Q&&t.call(e)},!1);var s=document.getElementById("btn-pause"),n=document.getElementById("btn-restart"),a=document.getElementById("btn-playagain");s.addEventListener("click",t.bind(this)),n.addEventListener("click",this.reset.bind(this)),a.addEventListener("click",this.reset.bind(this))},s.prototype.gameLoop=function(e){if(this.gameOver&&this.end(),e<this.lastFrameTimeMs+1e3/this.maxFPS*this.gravity)this.raf=requestAnimationFrame(this.gameLoop.bind(this));else{this.delta+=e-this.lastFrameTimeMs,this.lastFrameTimeMs=e,e>this.lastFpsUpdate+1e3&&(this.fps=.25*this.framesThisSecond+.75*this.fps,this.lastFpsUpdate=e,this.framesThisSecond=0),this.framesThisSecond++;for(var t=0;this.delta>=this.timestep&&(this.update(),this.delta-=this.timestep,!(++t>=240)););this.draw(),this.raf=requestAnimationFrame(this.gameLoop.bind(this))}},s.prototype.draw=function(){this.onDeck&&(this.board.activePiece=this.onDeck,this.onDeck=null),this.board.draw();var e=this.board.movePieceDown();!0===e&&(this.gameOver=!0,this.paused=!0),e instanceof t.Piece&&(this.onDeck=e)},s.prototype.update=function(){var e=this.board.clearLines();this.lines+=e,this.linesEl.textContent=""+this.lines,this.score+=this.getScoreForLines(e),this.scoreEl.textContent=""+this.score,this.shouldIncreaseLevel()&&(this.level++,this.gravity=this.gravity-4),this.levelEl.textContent=""+this.level},s.prototype.pauseGame=function(){cancelAnimationFrame(this.raf);var e=document.getElementById("pause-overlay");e&&(e.style.display="block")},s.prototype.unpauseGame=function(){var e=document.getElementById("pause-overlay");e&&(e.style.display="none"),this.raf=requestAnimationFrame(this.gameLoop.bind(this))},s.prototype.end=function(){var e=document.getElementById("overlay");e&&(e.style.display="block")},s.prototype.reset=function(e){cancelAnimationFrame(this.raf);var t=document.getElementById("overlay");t&&(t.style.display="none"),this.gameOver=!1,this.lines=0,this.score=0,this.level=0,this.gravity=40,this.board.reset(),this.raf=requestAnimationFrame(this.gameLoop.bind(this))},s.prototype.getScoreForLines=function(e){return[0,40,100,300,1200][e]*(this.level+1)},s.prototype.shouldIncreaseLevel=function(){return 10!==this.level&&this.lines>=10*(this.level+1)},s}(),n=document.getElementById("game"),a=new s(n);a.start();
},{"./model/board":4,"./model/piece":5,"./util/keys":6}]},{},[3])